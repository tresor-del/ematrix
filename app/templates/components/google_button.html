{% load socialaccount %}

<a
    id="google"
    href="{% provider_login_url 'google' method='oauth2' %}"
    class="btn mb-2 google-btn"
    role="button"
>
    <div id="spinner" class="google-spinner"></div>
    <img
        id="google-icon"
        src="https://fonts.gstatic.com/s/i/productlogos/googleg/v6/24px.svg"
        alt="Google icon"
        width="20"
        height="20"
    />
    <span id="text">{{ button_text }}</span>
</a>

<style>
    .google-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 10px;
        font-weight: bold;
        opacity: 0.8;
        background-color: #e0d9d9;
        position: relative;
        transition: all 0.3s ease;
    }
    .google-btn:hover {
        background-color: #eaedf0;
        color: #333;
        opacity: 1;
    }

    .google-btn img {
        margin-right: 10px;
        display: inline;
        transition: opacity 0.3s ease;
    }
    
    .google-spinner {
        position: absolute;
        left: 10px;
        width: 20px;
        height: 20px;
        border: 2px solid rgba(243, 243, 243, 0.3);
        border-top: 2px solid #4285F4;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        opacity: 0;
        transition: opacity 0.3s ease;
    }
    
    .google-btn.loading .google-spinner {
        opacity: 1;
    }
    
    .google-btn.loading .google-icon {
        opacity: 0;
    }
    
    .google-btn.loading #text {
        margin-left: 25px;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>

<script>
    document.getElementById("google").addEventListener("click", function(e) {
        // Empêcher la navigation immédiate pour montrer l'état de chargement
        e.preventDefault();
        
        const btn = this;
        const href = btn.href;
        
        // Activer l'état de chargement
        btn.classList.add('loading');
        document.getElementById("text").innerText = "{{ loading_text }}";
        btn.style.cursor = "wait";
        btn.disabled = true;
        
        // Délai minimal pour montrer le spinner (UX)
        setTimeout(() => {
            // Redirection après avoir montré le spinner
            window.location.href = href;
        }, 500);
        
        // Gestion de secours si la redirection échoue
        setTimeout(() => {
            if (!document.hidden) {
                btn.classList.remove('loading');
                btn.style.cursor = "pointer";
                btn.disabled = false;
                document.getElementById("text").innerText = "{{ button_text }}";
            }
        }, 10000); // Timeout après 10s
    });
</script>